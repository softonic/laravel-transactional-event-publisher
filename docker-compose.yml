services:
  php:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app

  install:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "git config --global --add safe.directory /app && composer install"

  update:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "git config --global --add safe.directory /app && composer update"

  phpunit:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "git config --global --add safe.directory /app && composer phpunit"

  tests:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "git config --global --add safe.directory /app && composer run tests"

  phpstan:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "git config --global --add safe.directory /app && composer run phpstan"

  fixcs:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "git config --global --add safe.directory /app && composer run fix-cs"

  # Debug service with Xdebug enabled (use this when you need to debug)
  debug:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./:/app
    command: sh -c "mv /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini.disabled /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini 2>/dev/null || true; php -dxdebug.mode=debug -dpcov.enabled=0 $@"
